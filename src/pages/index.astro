---
import Layout from "../layouts/Global.astro";
import type { Article } from "../types/article";
import dayjs from "dayjs";
import customParseFormat from "dayjs/plugin/customParseFormat";
dayjs.extend(customParseFormat);

// Return the list of articles in the "articles" directory
const articles = await Astro.glob<Article>("./articles/*.md");

// Parse the date of each article, sort by date descending and return an array of the 4 last articles
const sortedArticle = articles
  .map((article) => {
    const { title, date, description, image } = article.frontmatter;
    return {
      title,
      date: dayjs(date, "DD-MM-YYYY").format("YYYY-MM-DD"),
      description,
      url: article.url,
      image: image,
    };
  })
  .sort((a, b) => {
    return dayjs(b.date).diff(dayjs(a.date));
  })
  .splice(0, 5);
---

<Layout
  title="Julien"
  description="I'm Julien, a 19 years old developer. I occasionnaly publish articles about programming and tech."
>
  <div class="bg-neutral-800 p-6 rounded-lg">
    <h1
      class="lg:text-4xl md:text-3xl text-2xl font-bold bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 bg-clip-text text-transparent"
    >
      Welcome to my website
    </h1>
    <p class="text-neutral-400 text-sm md:text-[15px] mt-2 mb-2">
      I'm <b>Julien C</b>, a 19 years old developer. I'm currently studying for
      a "licence informatique" (the French equivalent of a CS degree). I love
      building projects in my spare time. <br />
      You'll find my articles and the list of my projects on this website.
    </p>
  </div>

  <h2 class="text-base md:text-xl mt-8 mb-4">
    My {sortedArticle.length} last article{sortedArticle.length > 1 ? "s" : ""}
  </h2>
  <div class="flex flex-wrap gap-3">
    {
      sortedArticle.map((article) => (
        <a
          href={article.url}
          class="inline-block w-[100%] sm:w-[48%] bg-neutral-800 p-4 rounded-lg article"
        >
          <img
            src={"/images/" + article.image}
            class="w-full object-cover rounded-lg aspect-video mb-4"
            alt={article.title}
          />
          <div>
            <h2 class="font-medium text-sm  md:text-base ">{article.title}</h2>
            <p class="text-neutral-500">
              {dayjs(article.date, "YYYY-MM-DD")
                .format("DD/MM/YYYY")
                .toString()}
            </p>
          </div>
        </a>
      ))
    }
  </div>
</Layout>

<style>
  a:hover {
    transform: scale(1.03);
  }
  .article {
    transition: transform 0.15s ease-in-out;
  }
</style>
